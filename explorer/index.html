<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://volbil.github.io/business-tycoon/business-tycoon.min.css">
		<link rel="stylesheet" href="https://volbil.github.io/entypo/entypo.css">
		<link href="https://microbitcoinorg.github.io/misc/favicon.ico" rel="icon" type="image/x-icon">
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/jdenticon@3.2.0/dist/jdenticon.min.js"></script>
		<script src="https://code.highcharts.com/highcharts.src.js"></script>

		<style>
			html {
				height: 100%;
			}
			html, body {
				min-height: 100%;
			}
			body {
				padding-top: 75px;
				padding-bottom: 56px;
				position: relative;
			}
			#supply {
				cursor: pointer;
			}
			#qrCode canvas{
				max-width: 100%;
			}
			.router-page {
				display: none;
			}
			.flex-center {
				display: flex;
				align-items: center;
				justify-content: center;
			}
			[class*="entypo"]:before {
				font-family: 'EntypoRegular', sans-serif;
				font-size: 16px;
			}
			@media (max-width: 991.98px) {
				.navbar-expand-lg>.container, .navbar-expand-lg>.container-fluid {
					padding-right: 15px;
					padding-left: 15px;
				}
			}
			code {
				background: #3f3f3f;
				color: #ffffff;
				padding: 3px;
				border-radius: 5px;
			}
			.modal-dialog {
				max-width: 530px;
			}
			.text-monospace {
				font-size: 14px;
			}
			small .text-monospace {
				font-size: 12px;
			}
		</style>
		<title>Blockchain Explorer</title>
		<meta name="description" content="MicroBitcoin Blockchain Explorer">
	</head>
	<body>
		<!-- Navbar -->
		<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
			<div class="container">
				<a href="#" class="navbar-brand">
					<svg id="logo" style="max-width: 15px;margin-top: -5px;margin-right: 5px;" data-name="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 290.82 480"><defs><style>.cls-1{fill:#fff;}</style></defs><title>mbc_whiteicon</title><path class="cls-1" d="M110.59,412.2q0-154.62,0-309.25c.08-.4.19-.8.24-1.2.26-1.9.37-3.82.78-5.68C115.3,79.56,128.94,68,146.06,66.85c2.9-.19,5.82,0,8.88,0V65q0-11.51,0-23a21,21,0,0,1,2.72-10.45c4.19-7.45,10.78-11.77,18.8-14.11,2.28-.66,4.65-1,7-1.48h7.2a4.15,4.15,0,0,0,.79.25,34.53,34.53,0,0,1,13,4c9.41,5.18,15,12.69,14.72,23.91-.18,7,0,14,0,21v1.48h36.33V64.93q0-11.44,0-22.88a20.7,20.7,0,0,1,2.25-9.56c4.08-8,10.9-12.53,19.27-15,2.28-.67,4.66-1,7-1.47h7.2a5.89,5.89,0,0,0,.93.26,34.58,34.58,0,0,1,12.71,3.87c9.59,5.23,15.17,12.89,14.86,24.28-.21,7.57,0,15.15-.06,22.73,0,1,.23,1.44,1.34,1.68,27.3,5.89,48.79,20.41,64.25,43.67a96.28,96.28,0,0,1,15.73,45c.15,1.6.35,3.2.53,4.8v9.21a7,7,0,0,0-.23.94c-.43,3.81-.58,7.67-1.3,11.42-6.09,32.14-23.7,55.91-52.3,71.64-1.33.73-2.7,1.38-4.19,2.14.38.22.57.35.78.45a99.39,99.39,0,0,1,34.49,27,98.22,98.22,0,0,1,22.22,53.8c.15,1.6.35,3.19.53,4.79v9.21a5,5,0,0,0-.23.94,94.9,94.9,0,0,1-11,40.3c-15,28-38.19,45.41-69.22,52.3-1.05.23-1.4.56-1.39,1.65,0,7,0,14,0,21a23.11,23.11,0,0,1-7,17c-12,12.2-34,13.36-47.5,2.52-6.43-5.17-10-11.71-9.74-20.16.16-6.09,0-12.19,0-18.28v-1.55H219.1v1.65c0,6.29-.05,12.57,0,18.86a23.08,23.08,0,0,1-7.45,17.46c-11.8,11.42-32.44,12.69-46,2.81-7.11-5.19-11-12-10.8-21.09.15-6,0-12.09,0-18.14v-1.64h-7.19a37.26,37.26,0,0,1-36.31-30.21C111.07,416.26,110.87,414.23,110.59,412.2ZM234.1,196.25h62.18c7.14,0,14.3-.17,21.43.05a31.46,31.46,0,1,0,1.48-62.89l-41.58,0H229.15l-48,0c-22.34,0-37.63,22.6-29.06,43.23,2,4.93,4.92,9.52,7.46,14.24,3.92,7.25,7.88,14.47,11.83,21.7l14,25.73q5.51,10.09,11,20.2a1.55,1.55,0,0,1,0,1.26q-5.52,10.08-11.11,20.13L169.4,308.47c-4.71,8.51-9.33,17.06-14.14,25.52-3.28,5.77-5.92,11.65-6.13,18.47-.48,15.47,11,29.58,26.26,31.76,3.6.51,7.34.06,11,.06H287.54c8.68,0,17.36,0,26,0,4.5,0,9,.34,13.47-.7a31.45,31.45,0,0,0,24.24-35.62c-2-14.28-14.62-25.83-29-26.44-5.83-.25-11.68-.13-17.53-.12-7.23,0-14.46.08-21.69.08s-14.74-.08-22.12-.08-14.45.06-21.68.09H234.2c.43-.83.72-1.42,1-2l10.44-18.86,14.06-25.4c5.31-9.59,5.88-19.41,1.25-29.38-1.77-3.82-3.94-7.45-6-11.15q-7.9-14.51-15.82-29C237.54,202.61,235.88,199.54,234.1,196.25Z" transform="translate(-110.59 -16)"/></svg>
					<b>Explorer</b>
				</a>
				<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarResponsive">
					<ul class="navbar-nav ml-auto">
						<li class="nav-item">
							<a href="#" class="nav-link">Home</a>
						</li>
						<li class="nav-item">
							<a href="#/tokens" class="nav-link">Tokens</a>
						</li>
						<li class="nav-item">
							<a href="https://microbitcoinorg.github.io/api/" target="_blank" class="nav-link">API</a>
						</li>
						<li class="nav-item">
							<a href="https://microbitcoinorg.github.io/wallet/#/" target="_blank" class="nav-link">Wallet</a>
						</li>
						<li class="nav-item dropdown" id="network-list">
							<a class="nav-item nav-link dropdown-toggle" href="#" id="network-versions" data-toggle="dropdown">NETWORK</a>
							<div class="dropdown-menu dropdown-menu-right" aria-labelledby="network-versions" ></div>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		
		<!-- Error message and search -->
		<div class="container">
			<div id="error-message" class="alert alert-warning d-none" role="alert">
				Error, yay ∠( ᐛ 」∠)
			</div>
			<div class="card mb-3">
				<div class="card-body">
					<form id="search-form">
						<div class="input-group">
							<input type="text" id="search-field" name="search-field" class="form-control" placeholder="Block, hash, transaction, token, etc..." aria-label="Recipient's username" aria-describedby="button-addon2">
							<div class="input-group-append">
								<button class="btn btn-outline-dark" type="submit" id="button-addon2">Search!</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	
		<!-- Home page -->
		<div id="homepage" class="router-page">
			<div class="container">
				<div id="charts" class="card mb-3 d-none">
					<div class="card-body pb-2">
						<div>
							<div class="panel-body chart-wrapper" id="network-chart"></div>
							<div class="text-center small text-success" id="supply">
								<b>Circulating supply: <span>Loading...</span></b>
							</div>
						</div>
					</div>
				</div>
				<div class="card mb-3">
					<div class="table-responsive">
						<table id="blocks-table" class="table table-borderless table-md table-striped text-center mb-0">
							<thead>
								<tr>
									<th scope="col">Height</th>
									<th scope="col">Time</th>
									<th scope="col">Hash</th>
									<th scope="col">Transactions</th>
								</tr>
							</thead>
							<tbody>
								
							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div class="flex-center">
				<button id="more" style="width: 190px;" class="btn btn-outline-dark mb-3 load-btn">
					Load more
				</button>
			</div>
		</div>
	
		<!-- Block page -->
		<div id="block" class="router-page">
			<div class="container">
				<div id="block-info-table">
					
				</div>
				<div id="block-transactions" class="mb-3"></div>
			</div>

			<div class="flex-center">
				<button id="more-block-transactions" style="width: 190px;" class="btn btn-outline-dark mb-3 load-btn d-none">
					Load more
				</button>
			</div>
		</div>
	
		<!-- Transaction page -->
		<div id="transaction" class="router-page">
			<div class="container">
				<div id="tx-info-table">
					
				</div>

				<div class="card mb-3" id="tx-token-transfer">
					<div class="card-header">
						Token transfers
					</div>
					<div class="card-body">
						<div class="list-group">
							<div id="tx-token-transfer-content"></div>
						</div>
					</div>
				</div>

				<div class="card mb-3" id="tx-info-vout-total">
					<div class="card-header">
						Outputs: <b>0</b>
					</div>
					<div class="card-body">
						<div class="list-group">
						  	<div id="tx-vout-list">

						  	</div>
						</div>
					</div>
				</div>

				<div class="card mb-3" id="tx-info-vin-total">
					<div class="card-header">
						Inputs: <b>0</b>
					</div>
					<div class="card-body">
						<div class="list-group">
						  	<div id="tx-vin-list">
						  		
						  	</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	
		<!-- Address page -->
		<div id="address" class="router-page">
			<div class="container">
				<div id="address-info-table">
					
				</div>

				<div class="card mb-3 d-none" id="address-token-balances">
					<div class="card-header">
						Tokens held: <b id="tokens-held">0</b>
					</div>
					<div class="card-body">
						<div class="list-group">
							<div id="address-balances-list"></div>
						</div>
					</div>
				</div>

				<div class="card mb-3" id="address-history">
					<div class="card-header">
						Transactions: <b>0</b>
					</div>
					<div class="card-body">
						<div class="list-group">
						  	<div id="address-history-list">
						  		
						  	</div>
						</div>
					</div>
				</div>
				<div id="address-transactions" class="mb-3"></div>
			</div>

			<div class="flex-center">
				<button id="more-address-transactions" style="width: 190px;" class="btn btn-outline-dark mb-3 load-btn d-none">
					Load more
				</button>
			</div>
		</div>

		<!-- Tokens page -->
		<div id="tokens" class="router-page">
			<div class="container">
				<div class="card mb-3">
					<div class="table-responsive">
						<table id="tokens-table" class="table table-borderless table-md table-striped text-center mb-0">
							<thead>
								<tr>
									<th scope="col">Ticker</th>
									<th scope="col">Supply</th>
									<th scope="col">Transfers</th>
									<th scope="col">Holders</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
				</div>

				<ul id="tokens-pagination" class="pagination"></ul>
			</div>
		</div>

		<!-- Token info page -->
		<div id="token" class="router-page">
			<div class="container">
				<div id="token-info-table">
					
				</div>
				<div id="token-transfers" class="mb-3"></div>

				<ul id="transfers-pagination" class="pagination"></ul>
			</div>
		</div>

		<!-- Token holders page -->
		<div id="holders" class="router-page">
			<div class="container">
				<div class="card mb-3">
					<div class="table-responsive">
						<table id="holders-table" class="table table-borderless table-md table-striped text-center mb-0">
							<thead>
								<tr>
									<th scope="col">Address</th>
									<th scope="col">Balance</th>
									<th scope="col">Received</th>
									<th scope="col">Sent</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
				</div>

				<ul id="holders-pagination" class="pagination"></ul>
			</div>
		</div>
		
		<!-- QR code modal window -->
		<div id="qrModal" class="modal" tabindex="-1" role="dialog" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<div class="col-10" style="word-wrap: break-word;">
							<b class="title"></b>
						</div>
						<div class="col-2">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
					</div>
					<div class="modal-body text-center">
						<div id="qrCode"></div>
					</div>
				</div>
			</div>
		</div>

		<!-- Footer :3 -->
		<footer class="mb-3">
			<div class="container text-center">
				Made with <span class="entypo heart text-danger"></span> by <a target="_blank" href="https://github.com/volbil/blockchain-explorer">Volbil</a>
			</div>
		</footer>

		<!-- All magic is here :D -->
		<script>
			// Config
			var networksConfigs = {
				'MBC': {
					'name': 'Main Network (MBC)',
					'api': 'https://api.mbc.wiki',
					'tokens': 'https://tokens.mbc.wiki',
					'ticker': 'MBC',
					'decimals': 4,
					'hrp': 'mbc'
				},
				// 'TMBC': {
				// 	'name': 'Test Network (TMBC)',
				// 	'api': 'https://api.mbc.wiki/test/',
				// 	'tokens': 'https://tokens.mbc.wiki',
				// 	'ticker': 'TMBC',
				// 	'decimals': 4,
				// 	'hrp': 'tmbc'
				// }
			}

			// Error messages
			var errorMessages = {
				'blocks-load-error': 'There was an error while trying to load the blocks!',
				'blocks-not-found': 'Block not found!',
				'tx-not-found': 'Transaction not found!',
				'nan-error': 'The height of the block should be a non-negative integer!',
				'no-block-specified': 'You must specify blocks!',
				'no-tx-specified': 'You must specify transaction!',
				'not-valid-address': 'You must specify valid address!',
				'search-error': 'We can\'t process your request :(',
				'circulating-supply-load-error': 'There was an error while trying to load the circulating supply :('
			}

			function showCharts(data) {
				var step = 2
				if ($(document).width() < 576) {
					step = 9
				} else if ($(document).width() < 1200) {
					step = 4
				}

				$('#charts').removeClass('d-none')
				Highcharts.chart('network-chart', {
					'chart': {
						'type': 'spline',
						'height': 240,
						'spacingTop': 20,
						'spacingBottom': 20
					},
					'title': {
						'text': ''
					},
					'xAxis': [{
						'categories': [].concat(data["blocks"]).reverse(),
						'crosshair': true,
						'labels': {
							'enabled': true,
							'step': step
						}
					}],
					'yAxis': [{
						'labels': {
							'enabled': false
						},
						'title': {
							'text': null
						}
					}, {
						'labels': {
							'enabled': false
						},
						'title': {
							'text': null
						}
					}, {
						'labels': {
							'enabled': false
						},
						'title': {
							'text': null
						},
						'opposite': true
					}, {
						'labels': {
							'enabled': false
						},
						'title': {
							'text': null
						}
					}, {
						'labels': {
							'enabled': false
						},
						'title': {
							'text': null
						}
					}],
					'tooltip': {
						'shared': true,
						formatter: function() {
							var s = '<b>' + this.x + '</b>';

							$.each(this.points, function(i, point) {
								text = point.y
								if (i == 3) {
									text = convertHashes(point.y)
								}

								s += '<br/><span style="color:' + point.color + '">\u25CF</span>: ' + point.series.name + ': ' + text;
							});

							return s;
						},
					},
					'plotOptions': {
						'series': {
							'animation': false,
							'label': {
								'connectorAllowed': true
							},
							'marker': {
								'enabled': false,
								'size': 2
							}
						}
					},
					'series': [{
						'name': 'Difficulty',
						'data': [].concat(data["diffs"]).reverse(),
						'yAxis': 1,
						'color': '#7cb5ec',
						'type': 'areaspline',
						'fillOpacity': 0.3
					}, {
						'name': 'Transactions',
						'data': [].concat(data["txs"]).reverse(),
						'yAxis': 2,
						'color': '#90ed7d'
					}, {
						'name': 'Size',
						'data': [].concat(data["sizes"]).reverse(),
						'yAxis': 3,
						'color': '#f7a35c'
					}, {
						'name': 'Network hashrate',
						'data': [].concat(data["nethash"]).reverse(),
						'yAxis': 4,
						'color': '#ff2a65'
					}],
					'responsive': {
						'rules': [{
							'condition': {
								'maxWidth': 500,
							},
							'chartOptions': {
								'legend': {
									'layout': 'horizontal',
									'align': 'center',
									'verticalAlign': 'bottom'
								}
							}
						}]
					}
				});
				$('.highcharts-credits').hide();
			}

			// Convert amount of hashes to readable form
			function convertHashes(hashes) {
				if (hashes >= 1000000000000000000000) {
					return (hashes / 1000000000000000000000).toFixed(2) + ' Zh/s'
				} else if (hashes >= 1000000000000000000) {
					return (hashes / 1000000000000000000).toFixed(2) + ' Eh/s'
				} else if (hashes >= 1000000000000000) {
					return (hashes / 1000000000000000).toFixed(2) + ' Ph/s'
				} else if (hashes >= 1000000000000) {
					return (hashes / 1000000000000).toFixed(2) + ' Th/s'
				} else if (hashes >= 1000000000) {
					return (hashes / 1000000000).toFixed(2) + ' Gh/s'
				} else if (hashes >= 1000000) {
					return (hashes / 1000000).toFixed(2) + ' Mh/s'
				} else if (hashes >= 1000) {
					return (hashes / 1000).toFixed(2) + ' Kh/s'
				} else {
					return hashes + ' H/s'
				}
			}

			function paginationNumbers(currentPage, totalPages) {
				if (currentPage == 1 && currentPage == totalPages) {
					return []
				}

				const MAX_PAGES = 5; // maximum number of pages to display in the pagination array
				const paginationArray = [];

				// add first page
				paginationArray.push(1);

				// if there are less than or equal to MAX_PAGES total pages, display all pages
				if (totalPages <= MAX_PAGES) {
					for (let i = 2; i <= totalPages - 1; i++) {
						paginationArray.push(i);
					}
				} else {
					// otherwise, display a subset of pages around the current page
					let startPage = Math.max(2, currentPage - Math.floor(MAX_PAGES / 2));
					let endPage = Math.min(totalPages - 1, startPage + MAX_PAGES - 1);

					// add ellipsis if needed
					if (startPage > 2) {
						paginationArray.push("...");
					}

					for (let i = startPage; i <= endPage; i++) {
						paginationArray.push(i);
					}

					// add ellipsis if needed
					if (endPage < totalPages - 1) {
						paginationArray.push("...");
					}
				}

				// add last page
				paginationArray.push(totalPages);

				return paginationArray;
			}

			// Display doc links
			function displayDocs() {
				$('a.api-link').each(function() {
					docsLink = getApi()['api'] + docs[$(this).attr('data-docs-link')];
					$(this).attr('href', docsLink)
					$(this).text(docsLink)
				});
			}

			// Get current network config
			function getApi() {
				var network = readCookie('network')
				if (network == null || networksConfigs[network] == undefined) {
					setCookie('network', Object.keys(networksConfigs)[0], 60)
					network = readCookie('network')
				}

				return networksConfigs[network]
			}

			// Switch network
			function switchApi(network, page = '') {
				network = network.toUpperCase()
				if (networksConfigs[network] != undefined & networksConfigs[network] != getApi()) {
					setCookie("network", network, 60)
					$('#blocks-table tbody').empty()
					$('#block-info-hash').empty()
					$('#data-address').empty()
					$('#tx-info-hash').empty()
					$('#charts').addClass('d-none')
					displayNetworks()
					displayHome()
				}
				switchPage(page)
			}

			// Display networks list
			function displayNetworks() {
				network = getApi()
				$('#network-versions').text(network['name'])
				$('#network-list .dropdown-menu').empty()

				for (var key in networksConfigs) {
					$('#network-list .dropdown-menu').append(`<a class="dropdown-item ${networksConfigs[key]['name'] == network['name'] ? 'active' : ''}" href="#/network/${key}">${networksConfigs[key]['name']}</a>`)
				}
			}

			function parseLocation(locationHash) {
				const parts = locationHash.split('/');
				const page = parts[1] || null;
				const index = parts[parts.length - 1].indexOf('?');
				const search = index !== -1 ? parts.slice(2, -1).concat(parts.slice(-1)[0].slice(0, index)).join('/') : parts.slice(2, -1).concat(parts.slice(-1)[0] || []).join('/') || null;
				const query = index !== -1 ? parts[parts.length - 1].slice(index + 1) : null;
				return {
					page,
					search,
					query
				};
			}


			// SPA router function
			function routePage() {
				if (window.location.hash == '') {
					window.location.replace(window.location.href.split('#')[0] + '#/')
				}

				const location = parseLocation(window.location.hash)

				const pageSearch = location.search
				let pageName = location.page
				let pageParams = null

				if (pageName == null) {
					pageName = "homepage"
				}

				if (location.query != null) {
					pageParams = new URLSearchParams(location.query)
				}

				const templateName = '#' + pageName
				
				if ($('.router-page:visible').attr('id') != pageName) {
					$('div.router-page').hide()
					if ($(templateName).length) {
						$(templateName).show()
					}
				}

				switch(pageName) {
					// Block info page
					case 'block':
						var block_hash = pageSearch
						var data_block_hash = $('#block-info-hash').attr('data-block-info-hash')
						if (block_hash != undefined && block_hash.length == 64) {
							if (data_block_hash != pageSearch) {
								$('#block-info-tx-total').addClass('d-none')
								$('#block-info-table').empty()
								blockInfo(block_hash).then(function(block) {
									if (block['error'] == undefined) {
										setTitle('Block #' + block.result.height)
										displayBlockInfo(block.result)
									} else {
										showError(errorMessages['blocks-not-found'])
										switchPage()
									}
								})
							} else {
								setTitle('Block #' + block_hash)
							}
						} else {
							showError(errorMessages['no-block-specified'])
							switchPage()
						}

						break

					// Transaction info page
					case 'transaction':
						var tx_hash = pageSearch
						var data_tx_hash = $('#tx-info-hash').attr('data-tx-info-hash')
						if (tx_hash != undefined) {
							if (data_tx_hash != pageSearch) {
								$('#tx-token-transfer').addClass('d-none')
								$('#tx-token-transfer-content').empty()

								$('#tx-info-vout-total').addClass('d-none')
								$('#tx-info-vin-total').addClass('d-none')
								$('#tx-info-table').empty()
								transactionInfo(tx_hash).then(function(tx) {
									if (tx['error'] == undefined) {
										setTitle('Transaction ' + tx_hash)
										displayTransactionInfo(tx.result)

										transactionInfoToken(tx_hash).then(function(tx_token) {
											if (tx_token.list.length > 0) {
												$('#tx-token-transfer').removeClass('d-none')
												displayTransactionTransfers(tx_token.list)
											}
										})
									} else {
										showError(errorMessages['tx-not-found'])
										switchPage()
									}
								})
							} else {
								setTitle('Transaction ' + data_tx_hash)
							}
						} else {
							showError(errorMessages['no-tx-specified'])
							switchPage()
						}

						break

					case 'address':
						var address = pageSearch
						var data_address = $('#data-address').attr('data-address')
						if (address != undefined) {
							if (data_address != pageSearch) {
								$('#address-history').addClass('d-none')
								$('#address-info-table').empty()
								addressBalance(address).then(function(data) {
									if (data['error'] == undefined) {
										setTitle('Address ' + address)
										displayAddressInfo(data.result, address)

										addressTokenBalances(address).then(function(data) {
											displayAddressTokenBalances(data)
										})
									} else {
										showError(errorMessages['not-valid-address'])
										switchPage()
									}
								})
							} else {
								setTitle('Address ' + data_address)
							}
						} else {
							showError(errorMessages['not-valid-address'])
							switchPage()
						}

						break

					// Redirect to block page by block height
					case 'height':
						block_height = pageSearch
						if (block_height != undefined && isNumeric(block_height)) {
							blockHeight(pageSearch).then(function(block) {
								setTitle('Loading')
								if (block['error'] == undefined) {
									switchPage('block', [block['result']['hash']])
								} else {
									showError(errorMessages['blocks-load-error'])
									switchPage()
								}
							})
						} else {
							showError(errorMessages['nan-error'])
							switchPage()
						}

						break

					// Tokens dashboard
					case 'tokens':
						setTitle('Tokens')

						let tokens_page = 1

						if (pageParams && pageParams.get("page")) {
							tokens_page = parseInt(pageParams.get("page"))
						}

						displayTokensList(tokens_page)

						break
					
					case 'token':
						setTitle('Token ' + pageSearch)

						let token_page = 1

						if (pageParams && pageParams.get("page")) {
							token_page = parseInt(pageParams.get("page"))
						}

						tokenInfo(pageSearch).then(function(data) {
							displayTokenInfo(data)

							tokenTransfers(pageSearch, token_page).then(function(data) {
								displayTokenTransfers(pageSearch, data)
							})
						}).catch(function(data) {
							showError(errorMessages['search-error'])
							switchPage()
						})

						break

					case 'holders':
						setTitle('Token ' + pageSearch + ' holders')

						let holders_page = 1

						if (pageParams && pageParams.get("page")) {
							holders_page = parseInt(pageParams.get("page"))
						}

						tokenHolders(pageSearch, holders_page).then(function(data) {
							displayTokenHolders(pageSearch, data)
						})

						break

					// Home page ¯\_(ツ)_/¯
					case 'homepage':
						setTitle('Latest Blocks')
						displayHome()

						break

					// Swith network to explore
					case 'network':
						network = pageSearch
						if (network != undefined) {
							switchApi(network)
						}

						break

					default:
						switchPage()

						break
				}
				// }
			}

			// Switch router page
			function switchPage(url = '', params = []) {
				params = params.length > 0 ? '/' + params.join('/') : ''
				window.location.hash = '#' + '/' + url + params;
			}

			// Set window title
			function setTitle(title) {
				document.title = title + ' | MBC Explorer';
			}

			// Bocks request
			function getBlocks(start, offset = 30) {
				return Promise.resolve($.ajax({
					'url': getApi()['api'] + '/range/' + start + '?offset=' + offset,
				})).then(function(data) {
					return data
				})
			}

			// Block info
			function blockInfo(hash, offset = 0) {
				return Promise.resolve($.ajax({
					'url': getApi()['api'] + '/block/' + hash + '?offset=' + offset,
				})).then(function(data) {
					return data
				})
			}

			// Get transaction info
			function transactionInfo(hash) {
				return Promise.resolve($.ajax({
					'url': getApi()['api'] + '/transaction/' + hash,
				})).then(function(data) {
					return data
				})
			}

			// Get transaction info
			function transactionInfoToken(hash) {
				return Promise.resolve($.ajax({
					'url': getApi()['tokens'] + '/layer/tx/' + hash,
				})).then(function(data) {
					return data
				})
			}

			// Get tokens list
			function tokensList(page = 1) {
				return Promise.resolve($.ajax({
					'url': getApi()['tokens'] + '/layer/tokens?page=' + page,
				})).then(function(data) {
					return data
				})
			}

			// Get token info
			function tokenInfo(ticker) {
				return Promise.resolve($.ajax({
					'url': getApi()['tokens'] + '/layer/token/' + ticker,
				})).then(function(data) {
					return data
				})
			}

			// Get token transfers
			function tokenTransfers(ticker, page = 1) {
				return Promise.resolve($.ajax({
					'url': getApi()['tokens'] + '/layer/token/' + ticker + '/transfers?page=' + page,
				})).then(function(data) {
					return data
				})
			}

			// Get token holders
			function tokenHolders(ticker, page = 1) {
				return Promise.resolve($.ajax({
					'url': getApi()['tokens'] + '/layer/token/' + ticker + '/holders?page=' + page,
				})).then(function(data) {
					return data
				})
			}

			// Get address token
			function addressTokenBalances(address) {
				return Promise.resolve($.ajax({
					'url': getApi()['tokens'] + '/layer/address/' + address
				})).then(function(data) {
					return data
				})
			}

			// Get address balance
			function addressBalance(address) {
				return Promise.resolve($.ajax({
					'url': getApi()['api'] + '/balance/' + address,
				})).then(function(data) {
					return data
				})
			}

			// Get address history
			function addressHistory(address, offset = 0) {
				return Promise.resolve($.ajax({
					'url': getApi()['api'] + '/history/' + address + '?offset=' + offset,
				})).then(function(data) {
					return data
				})
			}

			// Get current network info
			function networkInfo() {
				return Promise.resolve($.ajax({
					'url': getApi()['api'] + '/info',
				})).then(function(data) {
					return data
				})
			}

			// Get circulating supply
			function networkSupply() {
				return Promise.resolve($.ajax({
					'url': getApi()['api'] + '/supply',
				})).then(function(data) {
					return data
				})
			}

			// Get block by height
			function blockHeight(height) {
				return Promise.resolve($.ajax({
					'url': getApi()['api'] + '/height/' + height,
				})).then(function(data) {
					return data
				})
			}

			// Display stuffs here~
			function displayBlocks(blocks, prepend = false) {
				blocks = prepend ? blocks.reverse() : blocks
				blocks.forEach(function(block, index) {
					if ($('tr[data-height="' + block.height + '"]').length == 0) {
						var content = `
							<tr data-height="${block.height}">
								<td>
									<a href="#/block/${block.hash}">
										${block.height}
									</a>
								</td>
								<td>
									${timeFormat(block.time)}
								</td>
								<td>
									<a href="#/block/${block.hash}">
										${block.hash}
									</a>
								</td>
								<td>
									${block.txcount != undefined ? block.txcount : '1'}
								</td>
							</tr>`

						if (prepend) {
							$('#blocks-table tbody').prepend(content)
						} else {
							$('#blocks-table tbody').append(content)
						}
					}	

					if (block.height == 0) {
						$('#more').addClass('d-none')
					}
				});
			}

			function displayTokens(tokens, prepend = false) {
				$("#tokens-table tbody").empty()

				tokens.list.forEach(function(token, index) {
					if ($('tr[data-ticker="' + token.ticker + '"]').length == 0) {
						var content = `
							<tr data-ticker="${token.ticker}">
								<td>
									<a href="#/token/${token.ticker}">${token.ticker}</a>
								</td>
								<td>
									<span class="text-monospace">${amountFormatSatoshis(token.supply, token.decimals)}</span> ${token.ticker}
								</td>
								<td>
									${token.transfers}
								</td>
								<td>
									<a href="#/holders/${token.ticker}">${token.holders}</a>
								</td>
							</tr>`

						if (prepend) {
							$('#tokens-table tbody').prepend(content)
						} else {
							$('#tokens-table tbody').append(content)
						}
					}
				});

				const pagination = paginationNumbers(tokens.pagination.page, tokens.pagination.pages)

				$("#tokens-pagination").empty()
				$("#tokens-pagination").addClass("d-none")

				if (pagination.length > 0) {
					$("#tokens-pagination").removeClass("d-none")
				}

				for (const number of pagination) {
					if (number == "...") {
						$("#tokens-pagination").append(`
							<li class="page-item disabled">
								<a class="page-link" href="#">...</a>
							</li>
						`)
					} else {
						$("#tokens-pagination").append(`
							<li class="page-item ${tokens.pagination.page == number ? 'disabled' : ''}">
								<a class="page-link" href="#/tokens?page=${number}">${number}</a>
							</li>
						`)
					}
				}
			}

			function displayBlockInfo(data) {
				$('#block-transactions').empty()
				content = `
					<div class="card mb-3">
						<div class="table-responsive">
							<table class="table table-borderless table-md table-striped mb-0">
								<tbody>
									<tr>
										<td>Height</td>
										<td id="block-info-height" data-block-info-height="${data.height}">${data.height} (<b>Confirmations ${data.confirmations}</b>)</td>
									</tr>
									<tr>
										<td>Timestamp</td>
										<td>${timeFormat(data.time)} (<b>${data.time}</b>)</td>
									</tr>
									<tr>
										<td>Block Hash</td>
										<td id="block-info-hash" data-block-info-hash="${data.hash}">${data.hash}</td>
									</tr>
									<tr>
										<td>Mined Hash</td>
										<td>${data.minedhash}</td>
									</tr>
									<tr>
										<td>Previous Block</td>
										<td>
											<a class="${'previousblockhash' in data ? '' : 'd-none'}" href="#/block/${data.previousblockhash}">${data.previousblockhash}</a>
											<span class=${'previousblockhash' in data ? 'd-none' : ''}>
												<b>Genesis Block</b>
											</span>
										</td>
									</tr>
									<tr>
										<td>Next Block</td>
										<td>
											${data.nextblockhash != undefined ? `
												<a href="#/block/${data.nextblockhash}">
													${data.nextblockhash}
												</a>
											` : `
												<b>This is latest block</b>
											`}
										</td>
									</tr>
									<tr>
										<td>Merkle Root</td>
										<td>
											${data.merkleroot}
										</td>
									</tr>
									<tr>
										<td>Nonce</td>
										<td>${data.nonce}</td>
									</tr>
									<tr>
										<td>Version</td>
										<td>${data.versionHex}</td>
									</tr>
									<tr>
										<td>Bits</td>
										<td>${data.bits}</td>
									</tr>
									<tr>
										<td>Size</td>
										<td>${data.size} Bytes</td>
									</tr>
									<tr>
										<td>Stripped Size</td>
										<td>${data.strippedsize} Bytes</td>
									</tr>
									<tr>
										<td>Difficulty</td>
										<td>${data.difficulty}</td>
									</tr>
									<tr>
										<td>Transactions</td>
										<td>${data.txcount}</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>`

				$('#block-info-table').html(content)

				displayTransactions($('#block-transactions'), data.tx)

				if (data.txcount > $('#block-transactions').children().length) {
					$('#more-block-transactions').removeClass('d-none')
				} else {
					$('#more-block-transactions').addClass('d-none')
				}

				$('#block-info-tx-total').removeClass('d-none')
			}

			function displayTransactionInfo(data) {
				content = `
					<div class="card mb-3">
						<div class="table-responsive">
							<table class="table table-borderless table-md table-striped mb-0">
								<tbody>
									<tr>
										<td>Transaction Hash</td>
										<td id="tx-info-hash" data-tx-info-hash="${data.txid}">${data.txid}</td>
									</tr>
									${data.time != undefined ? `
										<tr>
											<td>Timestamp</td>
											<td>${timeFormat(data.time)} (<b>${data.time}</b>)</td>
										</tr>
									` : ''}
									<tr>
										<td>Height</td>
										<td>
											${data.blockhash != undefined ? `
												<a href="#/block/${data.blockhash}">${data.height}</a> (<b>Confirmations ${data.confirmations}</b>)
											` : `
												<span class="text-danger">This transaction located in memory pool and not included to blockchain yet!</span>
											`}
										</td>
									</tr>
									<tr>
										<td>Amount Transferred</td>
										<td>
											<span class="text-monospace">${amountFormat(data.amount)}</span> <b>${getApi()['ticker']}</b>
										</td>
									</tr>
									<tr>
										<td>Size</td>
										<td>${data.size} (bytes)</td>
									</tr>
									<tr>
										<td>Version</td>
										<td>${data.version}</td>
									</tr>
									<tr class="${data.locktime == 0 ? 'd-none' : ''}">
										<td>Locktime</td>
										<td>${data.locktime}</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>`

				$('#tx-info-table').html(content)
				$('#tx-info-vout-total .card-header b').text(data.vout.length)
				$('#tx-info-vin-total .card-header b').text(data.vin.length)
				$('#tx-vout-list').empty()
				$('#tx-vin-list').empty()

				var vin_amount = 0
				data.vin.forEach(function(vin) {
					vin_amount += vin.value
				})

				var vout_amount = 0
				data.vout.forEach(function(vout) {
					vout_amount += vout.value
				})

				var fee = vin_amount - vout_amount

				displayTxVout(data.vout, fee)
				displayTxVin(data.vin)

				$('#tx-info-vout-total').removeClass('d-none')
				$('#tx-info-vin-total').removeClass('d-none')
			}

			function displayTransactionTransfers(data) {
				for (let index = 0; index < data.length; index++) {
					const transfer = data[index];

					var content = `
						<div class="list-group-item flex-column align-items-start">
							<div class="row">
								<div class="col-md-9 col-sm-12 col-xs-12">
									<div class="${transfer.receiver == null ? "d-none" : ""}">
										<span class="text-muted mr-1">
										<span class="entypo right text-success"></span>
										<a href="#/address/${transfer.receiver}">${transfer.receiver}</a>
									</div>

									<div class="${transfer.sender == null ? "d-none" : ""}">
										<span class="text-muted mr-1">
										<span class="entypo left text-danger"></span>
										<a href="#/address/${transfer.sender}">${transfer.sender}</a>
									</div>
								</div>

								<div class="col-md-3 col-sm-12 col-xs-12 text-md-right">
									<div>
										<small class="text-muted">
											<span class="text-monospace">${amountFormatSatoshis(transfer.value, transfer.decimals)}</span> <b><a href="#/token/${transfer.token}">${transfer.token}</a></b>
										</small>
										<span class="badge badge-dark">${transfer.category}</span>
									</div>
								</div>
							</div>
						</div>
					`

					$('#tx-token-transfer-content').append(content)
				}
			}

			function displayTokenInfo(data) {
				content = `
					<div class="card mb-3">
						<div class="table-responsive">
							<table class="table table-borderless table-md table-striped mb-0">
								<tbody>
									<tr>
										<td>Ticker</td>
										<td>${data.ticker}</td>
									</tr>
									<tr>
										<td>Supply</td>
										<td>
											<span class="text-monospace">${amountFormatSatoshis(data.supply, data.decimals)}</span> ${data.ticker}
										</td>
									</tr>
									<tr>
										<td>Type</td>
										<td>${data.type}</td>
									</tr>
									<tr>
										<td>Decimals</td>
										<td>${data.decimals}</td>
									</tr>
									<tr>
										<td>Transfers</td>
										<td>${data.transfers}</td>
									</tr>
									<tr>
										<td>Holders</td>
										<td>
											<a href="#/holders/${data.ticker}">${data.holders}</a>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>`

				$('#token-info-table').html(content)
			}

			function displayTokenTransfers(ticker, transfers) {
				console.log(transfers)
				$("#token-transfers").empty()

				transfers.list.forEach(function(transfer, index) {
					var content = `
					<div class="card mt-3 light-shadow">
						<div class="card-header">
							Transaction: <a href="#/transaction/${transfer.txid}">
								${transfer.txid}
							</a>
							<div class="float-right">
								<span class="transaction-time">${timeFormat(transfer.created)}</span>
							</div>
						</div>
						<div class="card-body">
							<div class="list-group-item flex-column align-items-start">
								<div class="row">
									<div class="col-md-9 col-sm-12 col-xs-12">
										<div class="${transfer.receiver == null ? "d-none" : ""}">
											<span class="text-muted mr-1">
											<span class="entypo right text-success"></span>
											<a href="#/address/${transfer.receiver}">${transfer.receiver}</a>
										</div>

										<div class="${transfer.sender == null ? "d-none" : ""}">
											<span class="text-muted mr-1">
											<span class="entypo left text-danger"></span>
											<a href="#/address/${transfer.sender}">${transfer.sender}</a>
										</div>
									</div>

									<div class="col-md-3 col-sm-12 col-xs-12 text-md-right">
										<div>
											<small class="text-muted">
												<span class="text-monospace">${amountFormatSatoshis(transfer.value, transfer.decimals)}</span> <b><a href="#/token/${transfer.token}">${transfer.token}</a></b>
											</small>
											<span class="badge badge-dark">${transfer.category}</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					`

					$('#token-transfers').append(content)
				})
				
				const pagination = paginationNumbers(transfers.pagination.page, transfers.pagination.pages)

				$("#transfers-pagination").empty()
				$("#transfers-pagination").addClass("d-none")

				if (pagination.length > 0) {
					$("#transfers-pagination").removeClass("d-none")
				}

				for (const number of pagination) {
					if (number == "...") {
						$("#transfers-pagination").append(`
							<li class="page-item disabled">
								<a class="page-link" href="#">...</a>
							</li>
						`)
					} else {
						$("#transfers-pagination").append(`
							<li class="page-item ${transfers.pagination.page == number ? 'disabled' : ''}">
								<a class="page-link" href="#/token/${ticker}?page=${number}">${number}</a>
							</li>
						`)
					}
				}
			}

			function displayTokenHolders(ticker, holders) {
				$("#holders-table tbody").empty()

				holders.list.forEach(function(holder, index) {
					if ($('tr[data-holder="' + holder.address + '"]').length == 0) {
						var content = `
							<tr data-holder="${holder.address}">
								<td>
									<a href="#/address/${holder.address}">${holder.address}</a>
								</td>
								<td>
									<span class="text-monospace">${amountFormatSatoshis(holder.value, holder.decimals)}</span> ${holder.ticker}
								</td>
								<td>
									<span class="text-monospace">${amountFormatSatoshis(holder.received, holder.decimals)}</span> ${holder.ticker}
								</td>
								<td>
									<span class="text-monospace">${amountFormatSatoshis(holder.sent, holder.decimals)}</span> ${holder.ticker}
								</td>
							</tr>`

						$('#holders-table tbody').append(content)
					}
				});

				const pagination = paginationNumbers(holders.pagination.page, holders.pagination.pages)

				$("#holders-pagination").empty()
				$("#holders-pagination").addClass("d-none")

				if (pagination.length > 0) {
					$("#holders-pagination").removeClass("d-none")
				}

				for (const number of pagination) {
					if (number == "...") {
						$("#holders-pagination").append(`
							<li class="page-item disabled">
								<a class="page-link" href="#">...</a>
							</li>
						`)
					} else {
						$("#holders-pagination").append(`
							<li class="page-item ${holders.pagination.page == number ? 'disabled' : ''}">
								<a class="page-link" href="#/holders/${ticker}?page=${number}">${number}</a>
							</li>
						`)
					}
				}
			}

			function displayAddressTokenBalances(balances) {
				$("#address-token-balances").addClass("d-none")
				$("#address-balances-list").empty()
				$("#tokens-held").html(balances.stats.balances)

				if (balances.balances.length > 0) {
					$("#address-token-balances").removeClass("d-none")
				}

				balances.balances.forEach(function(balance, index) {
					var content = `
						<li class="list-group-item d-flex justify-content-between align-items-center">
							<span>
								<svg width="32" height="32" data-jdenticon-value="${balance.ticker}"></svg>
							</span>
							<span>
								<span class="text-monospace">${amountFormatSatoshis(balance.value, balance.decimals)}</span> <a href="#/token/${balance.ticker}">${balance.ticker}</a>
							</span>
						</li>
					`

					$('#address-balances-list').append(content)
				})

				jdenticon()
			}

			function showQrModal(e, text) {
				$('#qrCode').empty()
				$('#qrCode').qrcode(text)
				$('#qrModal .title').text(text)
				$('#qrModal').modal('toggle')
				e.preventDefault()
			}

			function displayAddressInfo(data, address) {
				$('#address-transactions').empty()
				content = `
					<div class="card mb-3">
						<div class="table-responsive">
							<table class="table table-borderless table-md table-striped mb-0">
								<tbody>
									<tr>
										<td>Address</td>
										<td id="data-address" data-address="${address}">
											${address}
											<a href="#" onclick="showQrModal(event, '${address}')">(QR)</a>
										</td>
									</tr>
									<tr>
										<td>Received</td>
										<td>
											<span class="text-monospace">${amountFormat(data.received)}</span> <b>${getApi()['ticker']}</b>
										</td>
									</tr>
									<tr>
										<td>Balance</td>
										<td>
											<span class="text-monospace">${amountFormat(data.balance)}</span> <b>${getApi()['ticker']}</b>
										</td>
									</tr>
									<tr>
										<td>Locked Balance</td>
										<td>
											<span class="text-monospace">${amountFormat(data.locked)}</span> <b>${getApi()['ticker']}</b>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>`

				$('#address-info-table').html(content)

				addressHistory(address).then(function(data) {
					if (data.error == undefined) {
						if (data.result.txcount > 10 && data.result.tx.length >= 10) {
							$('#more-address-transactions').removeClass('d-none')
						} else {
							$('#more-address-transactions').addClass('d-none')
						}

						$('#address-info .address-tx-count').text(data.result.txcount)
						displayTransactions($('#address-transactions'), data.result.tx)
					}
				})
			}

			function parseTransactionDetails(data) {
				var status = {
					'coinbase': false,
					'input': 0,
					'output': 0,
					'fee': 0,
					'from': '',
					'to': '',
					'badge': {
						'text': '',
						'class': ''
					}
				}

				inputs = {}
				outputs = {}

				data.vin.forEach(function(vin, index) {
					if (vin.coinbase != undefined) {
						status.coinbase = true
						status.from += `
							<li class="list-group-item">
								Newly Generated Coins (<b>Coinbase Transaction</b>)
							</li>`
					} else if (vin.value != undefined) {
						var address = vin.scriptPubKey.addresses[0]

						if (address in inputs) {
							inputs[address] += vin.value
						} else {
							inputs[address] = vin.value
						}

						status.input += vin.value
					}
				})

				for (address in inputs) {
					var transfer_amount = amountFormat(inputs[address]) + ' <b>' + getApi()['ticker'] + '</b>'

					content = `
						<a class="list-group-item list-group-item-action" href="#/address/${address}">
							<span class="entypo left text-danger"></span>
							<span class="text-primary">${address}</span>
							<small class="float-right text-muted">
								<span class="text-monospace">${transfer_amount}</span>
							</small>
						</a>`

					status.from += content
				}

				data.vout.forEach(function(vout, index) {
					if (vout.value != undefined) {
						if (vout.scriptPubKey.addresses != undefined) {
							var address = vout.scriptPubKey.addresses[0]

							if (address in outputs) {
								outputs[address] += vout.value
							} else {
								outputs[address] = vout.value
							}
						}

						status.output += vout.value
					}
				})

				for (address in outputs) {
					var transfer_amount = amountFormat(outputs[address]) + ' <b>' + getApi()['ticker'] + '</b>'

					content = `
						<a class="list-group-item list-group-item-action" href="#/address/${address}">
							<span class="entypo right text-success"></span>
							<span class="text-primary">${address}</span>
							<small class="float-right text-muted">
								<span class="text-monospace">${transfer_amount}</span>
							</small>
						</a>`

					status.to += content
				}

				if (!status.coinbase) {
					status.fee = status.input - status.output
					content = `
						<li class="list-group-item">
							<b>Total fee:</b>
							<small class="float-right text-muted">
								<span class="text-monospace">${amountFormat(status.fee)}</span> <b>${getApi()['ticker']}</b>
							</small>
						</li>`

					status.to += content
				}

				if (status.coinbase) {
					status.badge.text = 'Coinbase'
					status.badge.class = 'badge-primary'
				}

				return status
			}

			function loadTransactions(holder) {
				holder.find('[data-transaction][data-transaction-loaded=false]').each(function() {
					var tx = $(this)
					transactionInfo(tx.attr('data-transaction'), true).then(function(data) {
						if (data.error == undefined) {
							tx.find('.transaction-time').text(timeFormat(data.result.time)).removeClass('d-none')

							var status = parseTransactionDetails(data.result)

							if (status.hide) {
								tx.addClass('d-none')
							} else {
								tx.find('hr').removeClass('d-none')
								tx.find('.transaction-from').removeClass('d-none')
								tx.find('.transaction-to').removeClass('d-none')

								tx.find('.transaction-badge .badge').text(status.badge.text).removeClass('d-none')
								tx.find('.transaction-badge .badge').addClass(status.badge.class)
								tx.find('.transaction-badge').removeClass('d-none')

								tx.find('.transaction-from ul').append(status.from)
								tx.find('.transaction-to ul').append(status.to)
							}

							transactionInfoToken(tx.attr('data-transaction')).then(function(tx_token) {
								if (tx_token.list.length > 0) {
									// $('#tx-token-transfer').removeClass('d-none')
									// displayTransactionTransfers(tx_token.list)
									tx.find('.transaction-transfers').removeClass('d-none')

									for (let index = 0; index < tx_token.list.length; index++) {
										const transfer = tx_token.list[index];

										tx.find('.transaction-transfers ul').append(`
											<li class="list-group-item flex-column align-items-start">
												<div class="row">
													<div class="col-md-9 col-sm-12 col-xs-12">
														<div class="${transfer.receiver == null ? "d-none" : ""}">
															<span class="text-muted mr-1">
															<span class="entypo right text-success"></span>
															<a href="#/address/${transfer.receiver}">${transfer.receiver}</a>
														</div>

														<div class="${transfer.sender == null ? "d-none" : ""}">
															<span class="text-muted mr-1">
															<span class="entypo left text-danger"></span>
															<a href="#/address/${transfer.sender}">${transfer.sender}</a>
														</div>
													</div>

													<div class="col-md-3 col-sm-12 col-xs-12 text-md-right">
														<div>
															<small class="text-muted">
																<span class="text-monospace">${amountFormatSatoshis(transfer.value, transfer.decimals)}</span> <b><a href="#/token/${transfer.token}">${transfer.token}</a></b>
															</small>
															<span class="badge badge-dark">${transfer.category}</span>
														</div>
													</div>
												</div>
											</li>
										`)
									}
								}
							})

							tx.attr('data-transaction-loaded', true)
						}
					})
				})
			}

			function displayTransactions(holder, data, offset = 0) {
				var index = offset
				data.forEach(function(transaction) {
					content = `
						<div class="card mt-3 light-shadow" data-transaction="${transaction}" data-transaction-index="${index}" data-transaction-loaded="false">
							<div class="card-header">
								Transaction: <a href="#/transaction/${transaction}">
									${transaction}
								</a>
								<span class="transaction-badge">
									<span class="ml-1 badge"></span>
								</span>
								<div class="float-right">
									<span class="transaction-time"></span>
								</div>
							</div>
							<div class="card-body">
								<div class="row">
									<div class="col-12 transaction-transfers d-none">
										<ul class="list-group mb-3">
											<li class="list-group-item disabled">
												<b>Token transfers</b>
											</li>
										</ul>
									</div>

									<div class="col-12 transaction-from d-none">
										<ul class="list-group mb-3">
											<li class="list-group-item disabled">
												<b>Inputs</b>
											</li>
										</ul>
									</div>
									<div class="col-12 transaction-to d-none">
										<ul class="list-group">
											<li class="list-group-item disabled">
												<b>Outputs</b>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</div>`
					holder.append(content)
					index += 1
				})

				if (data.length > 0) {
					$('#more-block-transactions').removeClass('d-none')
				} else {
					$('#more-block-transactions').addClass('d-none')
				}

				loadTransactions(holder)
			}

			function displayTxVout(vout_list, fee = 0) {
				vout_list.forEach(function(vout, index) {
					if ($('#tx-vout-list').find(`[data-tx-vout-index="${index}"]`).length == 0) {
						if (vout.scriptPubKey.type != 'nulldata') {
							var content = `
								<a href="#/address/${vout.scriptPubKey.addresses[0]}" data-tx-vout-index="${vout.vout_index}" class="list-group-item list-group-item-action flex-column align-items-start">
									<div class="row">
										<div class="col-md-9 col-sm-12 col-xs-12">
											<span class="text-muted mr-1">
												<span class="entypo right text-success"></span>
											</span>
											<span class="text-primary">${vout.scriptPubKey.addresses[0]}</span>
										</div>
										<div class="col-md-3 col-sm-12 col-xs-12 text-md-right">
											<small class="text-muted">
												<span class="text-monospace">${amountFormat(vout.value)}</span> <b>${getApi()['ticker']}</b>
											</small>
										</div>
									</div>
								</a>`

							$('#tx-vout-list').append(content)
						} else {
							var content = `
								<li class="list-group-item">
									<code>${vout.scriptPubKey.asm}</code>
								</li>
							`

							$('#tx-vout-list').append(content)
						}
					}
				})

				if (fee > 0) {
					$('#tx-vout-list').append(`
						<li class="list-group-item">
							<b>Total fee:</b>
							<small class="float-right text-muted">
								<span class="text-monospace">${amountFormat(fee)}</span> <b>${getApi()['ticker']}</b>
							</small>
						</li>
					`)
				}
			}

			function displayTxVin(vin_list) {
				var total = $('#tx-info-vin-total .card-header b').text()
				vin_list.forEach(function(vin, index) {
					if (vin['coinbase'] != undefined) {
						$('#tx-vin-list').append('Newly Generated Coins (<b>Coinbase Transaction</b>)')
					} else {
						if ($('#tx-vin-list').find(`[data-tx-vin-index="${index}"]`).length == 0) {
							var content = `
							<div class="list-group-item flex-column align-items-start" data-tx-vin-index="${vin.vin_index}">
								<div class="row">
									<div class="col-md-9 col-sm-12 col-xs-12">
										<span class="text-muted mr-1">
											<span class="entypo left text-danger"></span>
										</span>
										<a href="#/address/${vin.scriptPubKey.addresses[0]}">
											${vin.scriptPubKey.addresses[0]}
										</a>
										(<a href="#/tx/${vin['txid']}">Output</a>)
									</div>
									<div class="col-md-3 col-sm-12 col-xs-12 text-md-right">
										<small class="text-muted">
											<span class="text-monospace">${amountFormat(vin.value)}</span> <b>${getApi()['ticker']}</b>
										</small>
									</div>
								</div>
							</div>`

							$('#tx-vin-list').append(content)
						}
					}
				})
			}

			function displayHistory(address, history_list) {
				var total = $('#address-history .card-header b').text()
				history_list.forEach(function(tx_info, index) {
					if ($('#address-history-list').find(`[data-address-history-index="${tx_info.tx_index}"]`).length == 0) {
						var content = `
							<a href="#/tx/${tx_info.data.txid}" data-address-history-index="${tx_info.tx_index}" class="list-group-item list-group-item-action flex-column align-items-start">
								<div class="row">
									<div class="col-md-9 col-sm-12 col-xs-12">
										<!-- <span class="text-muted mr-1">
											<span class="entypo left text-danger"></span>
										</span> -->
										<span class="text-primary">${tx_info.data.txid}</span>
									</div>
									<div class="col-md-3 col-sm-12 col-xs-12 text-md-right">
										<small class="text-muted">
											${tx_info.data.height > 0 ? '#' + tx_info.data.height : 'Mempool'}
										</small>
									</div>
								</div>
							</a>`

						$('#address-history-list').append(content)
					}
				})
			}

			function displayHome() {
				$('#supply span').text('Loading...')
				networkInfo().then(function(data) {
					var height = data.result.blocks
					var display_height = Number($('#blocks-table tbody tr:first-child').attr('data-height'))

					// Display circulating supply
					networkSupply().then(function(data) {
						if(data['error'] == undefined) {
							circulatingSupply = parseInt(amountFormat(data.result.supply))
							$('#supply span').text(circulatingSupply.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',') + ' ' + getApi()['ticker']);
						} else {
							showError(errorMessages['circulating-supply-load-error'])
						}
					});

					if (height != display_height || $('#blocks-table tbody tr').length > 0) {
						getBlocks(height).then(function(blocks) {
							if (blocks['error'] == undefined) {
								displayBlocks(blocks['result'], true)

								var chart_data = {
									'diffs': [],
									'blocks': [],
									'sizes': [],
									'timestamps': [],
									'txs': [],
									'nethash': []
								}

								$.each(blocks['result'].reverse(), function(index, block) {
									chart_data['diffs'].push(block['difficulty'])
									chart_data['blocks'].push(block['height'])
									chart_data['sizes'].push(block['size'])
									chart_data['timestamps'].push(block['time'])
									chart_data['txs'].push(block['txcount'])
									chart_data['nethash'].push(block['nethash'])
								})

								showCharts(chart_data)
							} else {
								showError(errorMessages['blocks-load-error'])
							}
						})
					}
				})
			}

			function displayTokensList(page) {
				tokensList(page).then(function(tokens) {
					displayTokens(tokens)
				})
			}

			// Set cookie
			function setCookie(name, value, days) {
				var expires;

				if (days) {
					var date = new Date();
					date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
					expires = '; expires=' + date.toGMTString();
				} else {
					expires = '';
				}
				document.cookie = encodeURIComponent(name) + '=' + encodeURIComponent(value) + expires + '; path=/';
			}

			// Read cookie
			function readCookie(name) {
				var nameEQ = encodeURIComponent(name) + '=';
				var ca = document.cookie.split(';');
				for (var i = 0; i < ca.length; i++) {
					var c = ca[i];
					while (c.charAt(0) === ' ') c = c.substring(1, c.length);
					if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
				}
				return null;
			}

			// Check if variable is number lol
			function isNumeric(num){
				return !isNaN(num)
			}

			// Convert satoshis to readable amount
			function amountFormat(amount) {
				var decimals = getApi()['decimals']
				return parseFloat((amount / Math.pow(10, decimals)).toFixed(decimals))
			}

			function amountFormatSatoshis(amount, decimals) {
				return parseFloat((amount / Math.pow(10, decimals)).toFixed(decimals))
			}

			// Convert timestamp to readable date
			function timeFormat(timestamp) {	 
				var months_arr = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
				var date = new Date(timestamp * 1000)
				var year = date.getFullYear()
				var month = months_arr[date.getMonth()]
				var day = date.getDate()
				var hours = date.getHours()
				var minutes = '0' + date.getMinutes()
				var seconds = '0' + date.getSeconds()
				var convdataTime = month + '-' + day + '-' + year + ' ' + hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2)

				return convdataTime
			}

			// Show big error message at the top of the page :D 
			function showError(message) {
				$('#error-message').text(message)
				$('#error-message').removeClass('d-none')
				setTimeout(function() {
					$('#error-message').addClass('d-none')
				}, 3400);
			}

			// Decode base58 encoded string to byte array
			function base58Data(string) {
				bs58Alphabet = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
				var bs58AlphabetMap = {}
				var base = bs58Alphabet.length
				var leader = bs58Alphabet.charAt(0)

				for (var i = 0; i < bs58Alphabet.length; i++) {
					bs58AlphabetMap[bs58Alphabet.charAt(i)] = i
				}

				if (string.length === 0) return []

				var bytes = [0]
				for (var i = 0; i < string.length; i++) {
					var value = bs58AlphabetMap[string[i]]
					if (value === undefined) throw new Error('Non-base' + base + ' character')

					var carry = bytes[0] * base + value
					bytes[0] = carry & 0xff
					carry >>= 8

					for (var j = 1; j < bytes.length; ++j) {
						carry += bytes[j] * base
						bytes[j] = carry & 0xff
						carry >>= 8
					}

					while (carry > 0) {
						bytes.push(carry & 0xff)
						carry >>= 8
					}
				}

				for (var k = 0; string[k] === leader && k < string.length - 1; ++k) {
					bytes.push(0)
				}

				return bytes.reverse()
			}

			function bech32Decode(bechString) {
				var charset = 'qpzry9x8gf2tvdw0s3jn54khce6mua7l'

				var p;
				var has_lower = false;
				var has_upper = false;

				for (p = 0; p < bechString.length; ++p) {
					if (bechString.charCodeAt(p) < 33 || bechString.charCodeAt(p) > 126) {
						return null;
					}
					if (bechString.charCodeAt(p) >= 97 && bechString.charCodeAt(p) <= 122) {
						has_lower = true;
					}
					if (bechString.charCodeAt(p) >= 65 && bechString.charCodeAt(p) <= 90) {
						has_upper = true;
					}
				}

				if (has_lower && has_upper) {
					return null;
				}

				bechString = bechString.toLowerCase();
				var pos = bechString.lastIndexOf('1');
				if (pos < 1 || pos + 7 > bechString.length || bechString.length > 90) {
					return null;
				}

				var hrp = bechString.substring(0, pos);
				var data = [];
				for (p = pos + 1; p < bechString.length; ++p) {
					var d = charset.indexOf(bechString.charAt(p));
					if (d === -1) {
						return null;
					}
					data.push(d);
				}

				return {
					'hrp': hrp,
					'data': data.slice(0, data.length - 6)
				};
			}

			function convertBits(data, frombits, tobits, pad) {
				var acc = 0;
				var bits = 0;
				var ret = [];
				var maxv = (1 << tobits) - 1;
				for (var p = 0; p < data.length; ++p) {
					var value = data[p];
					if (value < 0 || (value >> frombits) !== 0) {
						return null;
					}
					acc = (acc << frombits) | value;
					bits += frombits;
					while (bits >= tobits) {
						bits -= tobits;
						ret.push((acc >> bits) & maxv);
					}
				}
				if (pad) {
					if (bits > 0) {
						ret.push((acc << (tobits - bits)) & maxv);
					}
				} else if (bits >= frombits || ((acc << (tobits - bits)) & maxv)) {
					return null;
				}
				return ret;
			}

			function bech32Data(addr) {
				var hrp = getApi()['hrp']
				var dec = bech32Decode(addr)
				if (dec === null || dec.hrp !== hrp || dec.data.length < 1 || dec.data[0] > 16) {
					return null
				}

				var res = convertBits(dec.data.slice(1), 5, 8, false)
				if (res === null || res.length < 2 || res.length > 40) {
					return null
				}

				if (dec.data[0] === 0 && res.length !== 20 && res.length !== 32) {
					return null
				}

				return {'version': dec.data[0], 'program': res}
			}

			// Convert byte array to hex sting
			function hexString(byteArray) {
				return Array.from(byteArray, function(byte) {
					return ('0' + (byte & 0xFF).toString(16)).slice(-2);
				}).join('')
			}

			function initRouter() {
				routePage()
				window.router = false
				$(window).on('hashchange', routePage)
				if (window.location.hash) {
					if (window.router) {
						$(window).trigger('hashchange')
					}
					window.router = true
				}
			}

			// All starts here
			$(document).ready(function() {
				initRouter()
				displayNetworks()

				$('#supply').click(function() {
					displayHome()
				})

				$('#more').click(function() {
					var height = Number($('tr[data-height]').last().attr('data-height'))
					getBlocks(height).then(function(blocks) {
						if (blocks['error'] == undefined) {
							displayBlocks(blocks['result'])
						}
					})
				})

				$('#more-block-transactions').click(function() {
					var data_block_hash = $('#block-info-hash').text()
					var offset = Number($('#block-transactions [data-transaction-index]').last().attr('data-transaction-index')) + 1
					blockInfo(data_block_hash, offset).then(function(data) {
						if (data.error == undefined) {
							if (data.result.txcount > 10 && data.result.tx.length >= 10) {
								$(this).removeClass('d-none')
							} else {
								$(this).addClass('d-none')
							}

							displayTransactions($('#block-transactions'), data.result.tx, offset)
						}
					})
				})

				$('#more-address-transactions').click(function() {
					var data_address_link = $('#data-address').attr('data-address')
					var offset = Number($('#address-transactions [data-transaction-index]').last().attr('data-transaction-index')) + 1
					addressHistory(data_address_link, offset).then(function(data) {
						if (data.error == undefined) {
							if (data.result.txcount > 10 && data.result.tx.length >= 10) {
								$(this).removeClass('d-none')
							} else {
								$(this).addClass('d-none')
							}

							displayTransactions($('#address-transactions'), data.result.tx, offset)
						}
					})
				})

				$('#search-form').submit(function(e) {
					var search = $('#search-form input').val().trim()

					if (search != '') {
						if (isNumeric(search)) {
							switchPage('height', [search])
						} else {
							if (search.length == 64) {
								blockInfo(search).then(function(data) {
									if (data.error == undefined) {
										switchPage('block', [search])
									} else {
										switchPage('transaction', [search])
									}
								})
							} else if (search.length == 34 || search.substring(0, 3) == getApi()['hrp']) {
								switchPage('address', [search])
							} else {
								switchPage('token', [search])
							}
						}
					}

					$('#search-form input').val('')
					e.preventDefault()
				})

				window.setInterval(function() {
					displayHome()
				}, 30000);
			})
		</script>
	</body>
</html>
